# 📊 Kocom Wallpad RS485 패킷 분석 가이드

## 🔍 패킷 모니터링 도구 사용법

### 1. 패킷 모니터 실행

```bash
# SSH로 Home Assistant 접속 후
cd /share/kocom
python3 packet_monitor.py 192.168.0.222 8899
```

### 2. 월패드 버튼 테스트

모니터가 실행되면, 월패드에서 다음 버튼들을 하나씩 눌러보세요:

#### 조명 테스트
- [ ] 거실 조명 ON
- [ ] 거실 조명 OFF
- [ ] 방1 조명 ON/OFF
- [ ] 방2 조명 ON/OFF
- [ ] 방3 조명 ON/OFF
- [ ] 주방 조명 ON/OFF

#### 온도조절기 테스트
- [ ] 거실 온도 UP
- [ ] 거실 온도 DOWN
- [ ] 거실 난방 ON/OFF
- [ ] 각 방 온도 조절

#### 기타 장치
- [ ] 엘리베이터 호출
- [ ] 가스 차단
- [ ] 환기 팬

### 3. 캡처된 패킷 예시

```
[15:23:45.123] Packet #1
RAW: aa 55 30 bc 00 0e 01 01 00 3a 00 00 00 00 00 00 00 00 35 0d 0d
┌─ HEADER: AA55 (Kocom)
├─ TYPE: 30BC
├─ DEVICE: 000E → Light
├─ ROOM: 01 → Living Room
├─ COMMAND: 01
├─ DATA: 003A000000000000
├─ CHECKSUM: 0035
└─ TRAILER: 0D0D
   💡 Light ON command
```

## 📝 패킷 구조 분석

### 기본 구조
```
AA55 + TYPE(4) + DEVICE(4) + ROOM(2) + COMMAND(2) + DATA(16) + CHECKSUM(4) + 0D0D
```

### 장치 코드 (DEVICE)
| 코드 | 장치 | 설명 |
|------|------|------|
| 000E | Light | 조명 |
| 0036 | Thermostat | 온도조절기 |
| 002C | Gas | 가스밸브 |
| 0044 | Elevator | 엘리베이터 |
| 0048 | Fan | 환기팬 |
| 003B | Outlet | 콘센트 |
| 0039 | AC | 에어컨 |

### 방 코드 (ROOM)
| 코드 | 위치 |
|------|------|
| 00 | 전체/메인 |
| 01 | 거실 |
| 02 | 방1 |
| 03 | 방2 |
| 04 | 방3 |
| 05 | 주방 |

### 명령 코드 (COMMAND)
| 장치 | ON | OFF | 상태 |
|------|-----|-----|------|
| Light | 01 | 00 | 02 |
| Gas | 01 | 00 | - |
| Fan | 01-03 | 00 | - |

## 🔧 문제 해결

### 1. 패킷이 캡처되지 않는 경우
- EW11 IP 주소 확인 (192.168.0.222)
- 포트 번호 확인 (8899)
- RS485 케이블 연결 확인

### 2. 패킷은 보이지만 제어가 안 되는 경우
- 체크섬 계산 확인
- 장치 코드와 방 코드 매칭 확인
- 명령 코드가 올바른지 확인

### 3. 특정 장치만 작동하지 않는 경우
- 해당 장치의 실제 패킷 캡처
- kocom.py의 device_h_dic 확인
- room_h_dic 매핑 확인

## 📋 캡처된 패킷 기록

실제 월패드에서 캡처한 패킷을 아래에 기록해주세요:

### 조명 패킷
```
거실 조명 ON:  aa55________0d0d
거실 조명 OFF: aa55________0d0d
방1 조명 ON:   aa55________0d0d
방1 조명 OFF:  aa55________0d0d
```

### 온도조절기 패킷
```
거실 온도 23도: aa55________0d0d
거실 난방 ON:   aa55________0d0d
거실 난방 OFF:  aa55________0d0d
```

### 엘리베이터 패킷
```
엘리베이터 호출: aa55________0d0d
```

## 🚀 다음 단계

1. 패킷 모니터로 실제 패킷 캡처
2. 캡처된 패킷을 이 문서에 기록
3. kocom.py 코드 수정
4. 테스트 및 검증

---

**팁**: 패킷 모니터를 실행한 상태에서 월패드의 모든 버튼을 체계적으로 눌러보면서 패킷을 수집하세요. 이렇게 수집한 실제 패킷이 정확한 제어의 핵심입니다!